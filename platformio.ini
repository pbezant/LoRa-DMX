; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:heltec_wifi_lora_32_V3]
platform = espressif32
board = heltec_wifi_lora_32_V3
framework = arduino
lib_deps =
    bblanchon/ArduinoJson @ ^6.21.3
    someweisguy/esp_dmx @ ^4.1.0
    MCCI LoRaWAN LMIC library ; Replaces RadioLib and custom LoRaManager
monitor_speed = 115200
monitor_filters = 
    default
    time
build_flags =
    ; Suppress LMIC default project config to use pio build flags
    -D ARDUINO_LMIC_PROJECT_CONFIG_H_SUPPRESS
    
    ; LMIC region and radio configuration (US915 for SX1262)
    ; Verify these are correct for your specific Heltec LoRa 32 V3.
    ; The Heltec LoRa 32 V3 typically uses an SX1262.
    -D CFG_us915=1
    -D CFG_sx1262_radio=1    ; Correct flag for lmic/config.h for SX1262 radio
    ; MCCI LMIC Pin definitions for Heltec LoRa 32 V3 (SX1262)
    -D LMIC_NSS=8
    -D LMIC_RST=12
    -D LMIC_DIO0=4              ; Changed from LMIC_UNUSED_PIN to GPIO4
    -D LMIC_DIO1=14             ; Critical for SX126x
    -D LMIC_DIO2=LMIC_UNUSED_PIN
    -D LMIC_BUSY_LINE=13
    -D LMIC_SPI_FREQ=500000     ; Attempting 500kHz SPI for LoRa (was 8MHz)
    ; -D LMIC_CLOCK_ERROR_PPM=0 ; Optional clock error adjustment
    
    ; ArduinoJson and DMX library flags (if any were previously here)
    ; Retaining existing flags that are not RadioLib specific
    -D RADIOLIB_DEFAULT_SX126X_POWER=14 ; This might be RadioLib specific, review if needed for LMIC
    
    ; Default region settings - US915 by default, but can be configured in code
    ; These RADIOLIB_ flags are likely no longer needed with MCCI LMIC.
    ; -D RADIOLIB_DEFAULT_LORAWAN_REGION_US915=1
    ; -D LORA_DEFAULT_SUB_BAND=2
    
    ; Enable support for multiple frequency bands - uncomment as needed
    ; These RADIOLIB_ flags are likely no longer needed.
    ; -D RADIOLIB_LORAWAN_BAND_US915=1
    ; -D RADIOLIB_LORAWAN_BAND_EU868=1
    ; -D RADIOLIB_LORAWAN_BAND_AU915=1
    ; -D RADIOLIB_LORAWAN_BAND_AS923=1
    
    ; Enable verbose debugging for LoRaWAN
    ; These RADIOLIB_ flags are likely no longer needed.
    ; -D RADIOLIB_DEBUG_PROTOCOL=1
    ; -D RADIOLIB_DEBUG_BASIC=1
        
    ; Debug and optimization
    -D CORE_DEBUG_LEVEL=3                      ; Enable more debug output
    
    ; LoRaWAN optimization (LMIC has its own, review if these are still relevant)
    ; -D DISABLE_PING ; LMIC has its own DISABLE_PING
    ; -D DISABLE_BEACONS ; LMIC has its own DISABLE_BEACONS
    ; -D ARDUINO_LMIC_PROJECT_CONFIG_H_SUPPRESS ; Already added above
