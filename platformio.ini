; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env:heltec_wifi_lora_32_V3]
platform = espressif32
board = heltec_wifi_lora_32_V3
framework = arduino
lib_ldf_mode = deep+
lib_deps =
    bblanchon/ArduinoJson @ ^6.21.3
    Wire
    Heltec ESP32 Dev-Boards
monitor_speed = 115200
monitor_filters = 
    default
    time
build_flags =
    ; Debug and optimization
    -D CORE_DEBUG_LEVEL=3                      ; Enable more debug output
    -D LORAWAN_CLASS=CLASS_C                   ; Set LoRaWAN class
    -D ACTIVE_REGION=LORAMAC_REGION_US915      ; Set region to US915
    -D LORAWAN_DEVEUI_AUTO=0                   ; Disable auto-generated DevEUI
    -D LORAWAN_PREAMBLE_LENGTH=8               ; Set preamble length
    -D LORAWAN_ADR_ON=1                        ; Enable ADR by default
    -D LORAWAN_NET_RESERVE=0                   ; Disable network reserve
    -D CONFIG_ESP_TASK_WDT_TIMEOUT_S=120       ; Set watchdog timeout to 120 seconds
    -D LORAWAN_MAX_NB_CHANNELS=72              ; Set max channels for US915
    -D LORAWAN_DEFAULT_DATARATE=DR_0           ; Start with lowest data rate
    -D LORAWAN_PUBLIC_NETWORK=1                ; Enable public network mode
    -D LORAWAN_DUTY_CYCLE_ENABLED=0            ; Disable duty cycle for US915
    -D LORAWAN_REGION_US915_HYBRID=0           ; Disable hybrid mode for US915
    -D LORAWAN_REGION_US915_CHANNELS_MASK=0xFF00 ; Set channel mask for sub-band 2
    -D LORAWAN_REGION_US915_CHANNELS_DEFAULT_MASK=0xFF00 ; Set default channel mask
    -D LORAWAN_REGION_US915_CHANNELS_EXTRA_MASK=0x0002   ; Enable channel 65
    -D LORAWAN_REGION_US915_RX2_FREQUENCY=923300000      ; Set RX2 frequency
    -D LORAWAN_REGION_US915_RX2_DR=DR_8                  ; Set RX2 data rate
    -D LORAWAN_REGION_US915_DEFAULT_TX_POWER=20          ; Set default TX power
    -D LORAWAN_REGION_US915_MIN_RX1_DR_OFFSET=0          ; Set min RX1 DR offset
    -D LORAWAN_REGION_US915_MAX_RX1_DR_OFFSET=3          ; Set max RX1 DR offset
    -D LORAWAN_REGION_US915_DEFAULT_RX1_DR_OFFSET=0      ; Set default RX1 DR offset
    
    ; Include Heltec board configuration header globally
    -include "include/heltec_board_config.h"

; Add lib_extra_dirs to ensure local libraries are found
lib_extra_dirs =
    ${PROJECT_DIR}/lib
